<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Thibault Lestang">
  <meta name="author" content="Dominik Krzemiński">
  <meta name="author" content="Valerio Maggio">
  <meta name="keywords" content="Code Review, Software Sustainability
Institute, Research Software">
  <title>Investing in code reviews for better research software</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4/dist/reset.css">
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4/dist/reveal.css">
  <style>
    .reveal .sourceCode {  /* see #7635 */
      overflow: visible;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4/dist/theme/white.css" id="theme">
  <style>
  .slides {
      font-size: 0.85em;
  }
  </style>
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide">
  <h1 class="title">Investing in code reviews for better research
software</h1>
  <p class="author">Thibault Lestang</p>
  <p class="author">Dominik Krzemiński</p>
  <p class="author">Valerio Maggio</p>
</section>

<section id="part-1" class="slide level3">
<h3>Part 1</h3>
<h3>
What is a code review?
</h3>
<p><img data-src="img/detective.png" /></p>
</section>
<section id="code-review" class="slide level3">
<h3>Code review?</h3>
<p>Main benefits:</p>
<ol type="1">
<li><p>Catching bugs</p></li>
<li><p>Ensuring quality standard</p></li>
<li><p>Spreading knowledge</p></li>
<li><p>Training new developers</p></li>
</ol>
<figure>
<img data-src="img/men-talking.jpg" alt="__" />
<figcaption aria-hidden="true">__</figcaption>
</figure>
<aside class="notes">
<ul>
<li>Viewed as an important practice in the software industry.</li>
<li>Key step in contributing to most software projects
(gatekeeping).</li>
</ul>
</aside>
</section>
<section id="from-formal-inspections-to-code-review"
class="slide level3">
<h3>From formal inspections to code review</h3>
<p><img data-src="img/code_inspection_and_gitlab.png" /></p>
</section>
<section id="not-a-peer-review-for-code" class="slide level3">
<h3>Not a peer review for code</h3>
<ul>
<li>Code review <strong>throughout the research process</strong>:
<ul>
<li>Frequent</li>
<li>Informal</li>
<li>Low stakes</li>
</ul></li>
<li>Commonly referred as “Modern Code Review” in the SE litterature.
Bachelli and Bird 2013</li>
<li>Can be asynchronous (GitHub’s Pull Requests) or synchronous (in
person chat).</li>
</ul>
</section>
<section id="codecheck" class="slide level3">
<h3>CODECHECK</h3>
<figure>
<img data-src="img/checkers.png" alt="codecheck.org.uk" />
<figcaption aria-hidden="true">codecheck.org.uk</figcaption>
</figure>
</section>
<section id="two-contexts" class="slide level3">
<h3>Two contexts</h3>
<ol type="1">
<li>Individual developers writing their own specific software.</li>
<li>Developers collaboration on a common codebase.
<ul>
<li>Code review as gatekeeping.</li>
</ul></li>
</ol>
</section>
<section id="research-on-code-reviews" class="slide level3">
<h3>Research on code reviews</h3>
<p><em>Modern Code Review: A Case Study at Google</em> (Sadowski,
2018)</p>
<p><em>Expectations, Outcomes, and Challenges of Modern Code Review</em>
(Bacchelli and Bird, 2013)</p>
<p><em>Code Reviewing in the Trenches: Understanding Challenges and Best
Practices</em> (McLeod et al, 2017)</p>
<p><em>Code review by and for scientists</em> (Petre &amp; Wilson,
2014)</p>
</section>
<section id="part-2" class="slide level3">
<h3>Part 2</h3>
<h3>
Challenges of code reviews
</h3>
</section>
<section id="code-review-for-software-quality" class="slide level3">
<h3>Code review for software quality</h3>
<ol type="1">
<li>Defects</li>
<li>Code improvements</li>
</ol>
<p><img data-src="img/builder.png" /></p>
<aside class="notes">
<p>If you ask Microsoft developers about why they are doing code
reviews, you’ll find that the main motivation is making the code better.
This means identifying defects and improving the code.</p>
<p>Code improvements are changes that do not affect the functionalities
but make the code more readable or maintainable. You can think of
complying to a naming scheme, identifying code smells.</p>
</aside>
</section>
<section id="code-review-for-software-quality-1" class="slide level3">
<h3>Code review for software quality</h3>
<figure>
<img data-src="img/defects-improvement-bachelli-bird2013.png"
alt="(Bachelli &amp; Bird, 13)" />
<figcaption aria-hidden="true">(Bachelli &amp; Bird, 13)</figcaption>
</figure>
<aside class="notes">
<p>In practice, defects aren’t the first thing that code review really
help with. It can help, but maybe testing is a better investement in
order to prevent bugs.</p>
<p>But code review is clearly effective for improving code.</p>
</aside>
</section>
<section id="code-reviews-for-understandability" class="slide level3">
<h3>Code reviews for understandability</h3>
<p>More often than not source code is the only available form of
documentation.</p>
<p>Understandability is key for <strong>code reuse</strong> and
<strong>transparency</strong>.</p>
<aside class="notes">
<p>Understanbility goes beyond readability, it measures how easy it is
to get comfortable making changes to a software system.
Understandability is a prime quality for research software.</p>
<p>If you think of a research group in which researchers write their own
bespoke programs for their specific data manipulation or computational
experiement, these will not be documented.</p>
<p>Code review is a good assessment of understandability and this makes
it very attractive for research software.</p>
</aside>
</section>
<section id="code-reviews-for-team-awareness" class="slide level3">
<h3>Code reviews for team awareness</h3>
<ul>
<li>Continuous knowledge exchange.</li>
<li>Enhanced collaboration.</li>
<li>Longer term resilience of project(s) (Bus factor!).</li>
</ul>
<aside class="notes">
<p>Code review goes beyond understability. Esp important in research
where developers may be more isolated from each other and it’s easy to
struggle and come up with your own bespoke solutions.</p>
<p>I can tell you the sotry of what is happening currently at Imperial.
- Handful of PhD students, all training ML models - Need to read in and
manage many different parameters - Through code review became obvious
they are all trying to do similar thing. - Working together to come up
with a shared solution. - Common, standardized way of dealing with model
parameters that they all understand. They will benefit from that over
the course of their PhD.</p>
<p>Code review had an indicrect impact: people talk to each other
more.</p>
</aside>
</section>
<section id="code-reviews-for-knowledge-transfer" class="slide level3">
<h3>Code reviews for knowledge transfer</h3>
<p>Code review is peer learning.</p>
<ul>
<li>Spread of good practices.</li>
<li>Homogeneisation of styles and practices</li>
</ul>
<div class="fragment">
<pre><code>filepath = &quot;/my/own/specific/path/&quot; + &quot;data.csv&quot;</code></pre>
</div>
<div class="fragment">
<pre><code>from pathlib import Path
# ...
filepath = datadir_path / Path(datafile)</code></pre>
<aside class="notes">
<p>If the Bachelli sutdy was carried out in a lab, knowledge transfer
would be huge. Because knowledge is very unenvely distributed in
research.</p>
<p>Use of a yaml input file Dataclasses</p>
</aside>
</div>
</section>
<section id="code-review-is-challenging" class="slide level3">
<h3>Code review is challenging</h3>
<p>A lot of good practices around…</p>
<p>…but what about <strong>research software</strong>?</p>
<aside class="notes">
<p>The elephant in the room: nobody does code review. Some may do it as
part of collaborating on a distributed project.</p>
<p>Generally within a research group or a lab/department, for the
reasons above this is not happening.</p>
</aside>
</section>
<section id="code-review-is-time-and-energy" class="slide level3">
<h3>Code review is time and energy</h3>
<p>Two complementary courses of actions:</p>
<div>
<ul>
<li class="fragment">Regularly reflect process and follow good
practices.</li>
<li class="fragment">Acknowledge code review as a worthy investement:
<ul>
<li class="fragment">“middle-term” benefits for individuals.</li>
<li class="fragment">Short and long term benefits for collectives.</li>
</ul></li>
</ul>
</div>
<div class="fragment">
<p><strong>Large return on investment</strong></p>
<aside class="notes">
<p>It’s a fact but both time and energy investement can be reduced.</p>
<p>One prerequisite of code reivew is being okay with somebody looking
your code.</p>
</aside>
</div>
</section>
<section id="being-protective-about-code" class="slide level3">
<h3>Being protective about code</h3>
<ol type="1">
<li>There can be some unhealthy competition going on.</li>
<li>A large number of researchers feel shy about their coding
practices:</li>
</ol>
<ul>
<li>Lack of training.</li>
<li>Other priorities, often structural (e.g. funding).</li>
<li>Why would I share my code if nobody else does?</li>
</ul>
<div class="fragment">
<p>Code review can put software (back?) at the heart of the
collaborative scientific process.</p>
<aside class="notes">
<p>shame is perhaps the biggest issue. From my modest 5 years exp as a
full time RSE, I’ve worked with researchers in various and often feel
ashamed of their coding practice. Several factors: lack of training,
code is an afterthought, not used to share code. Code review can help
turn the tide.</p>
</aside>
</div>
</section>
<section id="strong-heterogeneity-among-team-members"
class="slide level3">
<h3>Strong heterogeneity among team members</h3>
<ul>
<li>Experience.</li>
<li>Skills (<em>e.g.</em> programming languages).</li>
<li>Interest &amp; motivation.</li>
</ul>
<aside class="notes">
<p>Code review litterature reports on the effect of heterogeneity among
participants who can be very junior developers up to employees with more
than 10 years experience int he software industry or even the same
company. They share common skill base, vocabulary, interest in SE.</p>
<p>But in research this is a whole other level of heterogeneity.</p>
</aside>
</section>
<section id="finding-reviewers" class="slide level3">
<h3>Finding reviewers</h3>
<p>What about “lone coders”?</p>
</section>
<section id="bad-experiences" class="slide level3">
<h3>Bad experiences</h3>
<p>Code review can lead both to inclusion and exclusion.</p>
<p>Dual nature: both <strong>technical</strong> and
<strong>social</strong> practice.</p>
</section>
<section id="bad-experiences-1" class="slide level3">
<h3>Bad experiences</h3>
<ul>
<li>Irrelevant feedback.</li>
<li>Petty arguments decoupled from overall scientific goal.</li>
<li>Power struggles.</li>
</ul>
<p>These must be and active effort to keep these under control. Similar
to technical debt.</p>
<div class="fragment">
<blockquote>
<p>A bad reviewer tries to force their preference on you. A good code
reviewer makes your code confrom to certain principles, but not opinion.
(<em>Quote from survey participant from Greiler, 2016</em>)</p>
</blockquote>
</div>
</section>
<section id="lack-of-guidelines" class="slide level3">
<h3>Lack of guidelines</h3>
<p>https://dev-review.readthedocs.io/</p>
<p>https://osc-delft.github.io/posts/2021/09/03/Research-Code-Review/</p>
<p>https://www.djmannion.net/code_review/</p>
<p>https://blog.hpc.qmul.ac.uk/code_review_whri.html</p>
</section>
<section id="part-3" class="slide level3">
<h3>Part 3</h3>
<h3>
Code reviews done right
</h3>
</section>
<section id="code-review-good-practices" class="slide level3">
<h3>Code review good practices</h3>
<p>A lot of the good practices from software engineering industry are
applicable, <strong>with a pinch of salt</strong>.</p>
<aside class="notes">
<p>The following results from combination of industry good practice and
observations/experimentation in a research context.</p>
</aside>
</section>
<section id="short-meetings" class="slide level3">
<h3>Short meetings</h3>
<p>3 times 30’ instead of one time 90’</p>
<ul>
<li>Fit in a busy schedule.</li>
<li>Doesn’t feel like a big commitment.</li>
<li>Code review can be a very demanding activity.</li>
</ul>
<p>Remember that software isn’t the primary driver.</p>
</section>
<section id="engage-with-the-review" class="slide level3">
<h3>Engage with the review</h3>
<p>Avoid “comfort mode” at all costs!</p>
<ul>
<li>Author describes goes through code as if logic and implementation is
obvious.</li>
<li>Reviewers assume author “know what they are doing”.</li>
</ul>
<div class="fragment">
<ul>
<li>Reviewers should <strong>never stop questionning</strong> and trying
to understand the code</li>
<li>Authors should <strong>give reviewers opportunities to
interject</strong>.</li>
</ul>
</div>
</section>
<section id="the-authors-part" class="slide level3">
<h3>The author’s part</h3>
<ul>
<li>Choose a small piece of code.</li>
<li>Provide a description of the purpose and structure of the code.</li>
<li>Think ahead what reviewers will and will not be familiar with
<ul>
<li>Specific libraries?</li>
<li>Specific domain knowledge?</li>
</ul></li>
<li>Ensure minimum quality standard (<em>e.g.</em> style, naming)</li>
</ul>
<p>Put yourself into your reviewer(s)’ shoes: what would you want to be
told if asked to review your code?</p>
<aside class="notes">
<p>A code review’s success partly rests on the author’s shoulder.
Authors are not entirely responsible for the review success, but can
definetely make it fail.</p>
</aside>
</section>
<section id="let-authors-specify-the-feedback-they-are-after"
class="slide level3">
<h3>Let authors specify the feedback they are after</h3>
<p><em>I’m not happy with this loop</em></p>
<pre><code>    for i in `seq 1 $NUMOFFIG`
    do
        FIG=$(ls $IMDIR | head -n $i | tail -n 1)
        echo &quot;    ${placeholderpath}/${FIG}&quot; &gt;&gt; $FILE
    done</code></pre>
<div class="fragment">
<p><em>I’m having to define a lot of classes that don’t do much, what do
you think of my design?</em></p>
</div>
<div class="fragment">
<p><em>I don’t have any specific issue in mind, but I’m curious to see
whether or not you find it hard to to follow the code’s logic.</em></p>
<aside class="notes">
<p>Feedback is likely to be more targeted and impactful.</p>
</aside>
</div>
</section>
<section id="define-and-enforce-a-scope" class="slide level3">
<h3>Define (and enforce) a scope</h3>
<p>Example default scope: understandability</p>
<ul>
<li>Poor formatting.</li>
<li>Obscure variable names.</li>
<li>Complex conditionals.</li>
<li>Long functions.</li>
<li>Long parameter lists.</li>
<li><del>Design red flags</del>.</li>
<li><del>Performance sinks</del>.</li>
<li><del>Security concerns</del>.</li>
</ul>
<p>Default scope can be overrriden at will.</p>
<aside class="notes">
<p>Another way to foster relevant feedback and discussions is to define
a scope.</p>
</aside>
</section>
<section id="whether-it-works-or-not-is-irrelevant"
class="slide level3">
<h3>Whether “it works” or not is irrelevant</h3>
<ul>
<li>Code review is not an evaluation of a finished product.</li>
<li>It is more rewarding to look at code that is WIP.</li>
<li>The only expectation is that code is readable by reviewers.</li>
</ul>
<aside class="notes">
<ul>
<li>Formatting, dead code, comments…</li>
</ul>
</aside>
</section>
<section id="make-it-formal-but-safe" class="slide level3">
<h3>Make it formal – but safe</h3>
<p>Code review is more effective with a clear process (formal)</p>
<p><em>At the same time,</em> Code review meetings <em>must</em> remain
inclusives and supporting spaces.</p>
<p><strong>It’s about creating an environment where people feel
confident about discussing their code to each other.</strong></p>
</section>
<section id="overheard-in-the-next-meeting-room" class="slide level3">
<h3>Overheard in the next meeting room</h3>
<p>Author: <em>This loop I wrote looks too complicated to me.</em></p>
<div class="fragment">
<p>Reviewer: <em>Hmmm yes. You could just use a pipe and
<code>xargs</code>.</em></p>
</div>
<div class="fragment">
<p>Author: <em>What’s <code>xargs</code>?</em></p>
</div>
<div class="fragment">
<p>Reviewer: <em>It’s basically mapping a command over a set of inputs -
think functional programming!</em></p>
</div>
<div class="fragment">
<p>Author: <em>…</em></p>
</div>
<div class="fragment">
<p>Reviewer: <em>Alhtough you could also do the same thing with
<code>sed</code>.</em></p>
</div>
<div class="fragment">
<p>Author (looking frustrated): <em>I have no idea what you’re talking
about.</em></p>
</div>
</section>
<section id="all-feedback-isnt-helpful" class="slide level3">
<h3>All feedback isn’t helpful</h3>
<p>…at least for now.</p>
<p>Reviewers with more programming experience/enthusiasm must be careful
not to overwhelm beginners.</p>
</section>
<section id="use-a-checklist" class="slide level3">
<h3>Use a checklist</h3>
<ul>
<li><input type="checkbox" disabled="" />
Poor formatting.</li>
<li><input type="checkbox" disabled="" />
Dead code.</li>
<li><input type="checkbox" disabled="" />
Missing documentation.</li>
<li><input type="checkbox" disabled="" />
Obscure names.</li>
<li><input type="checkbox" disabled="" />
Complex conditionals.</li>
<li><input type="checkbox" disabled="" />
Obscure one-liners.</li>
<li><input type="checkbox" disabled="" />
Duplicated code.</li>
<li><input type="checkbox" disabled="" />
Long procedures.</li>
<li><input type="checkbox" disabled="" />
Long parameter lists.</li>
<li><input type="checkbox" disabled="" />
Global state.</li>
<li><input type="checkbox" disabled="" />
Abuse of primitive types.</li>
<li><input type="checkbox" disabled="" />
Data clumps.</li>
<li>…</li>
</ul>
<aside class="notes">
<p>Give an opportunity for beginners to participate.</p>
<p>Start with the easy checks.</p>
</aside>
</section>
<section id="critique-the-code-not-the-programmer" class="slide level3">
<h3>Critique the code, not the programmer</h3>
<p><em>You clearly made little effort in naming things…</em></p>
<p><em>You should name this differently</em></p>
<p><em>I think this name is misleading</em></p>
<p>:::</p>
<p>Feedback can be hard to stomach</p>
<p>:::</p>
</section>
<section id="giving-feedback-is-not-trivial" class="slide level3">
<h3>Giving feedback is not trivial</h3>
<ol type="1">
<li>Own you opinions.</li>
<li>Make it about the code.</li>
<li>Be specific.</li>
<li>Suggest an alternative.</li>
</ol>
<div class="fragment">
<p><em>I think this function’s purpose would be much clearer if it was
given a more explicit name.. perhaps
<code>apply_bwd_transform</code>?</em></p>
</div>
</section>
<section id="define-and-refine-a-policy" class="slide level3">
<h3>Define (and refine) a policy</h3>
<ul>
<li>Well defined process.</li>
<li>Default scope.</li>
<li>Moderator(s).</li>
<li>Code of conduct.</li>
<li>Conflict resolution.</li>
</ul>
</section>
<section id="a-culture-of-openess-and-collaboration"
class="slide level3">
<h3>A culture of openess and collaboration</h3>
<ul>
<li>Components of a successful software project are
<ul>
<li>Code</li>
<li>People</li>
<li>Communication</li>
</ul></li>
<li>Research code review goes along with collective ownersip of research
project.</li>
</ul>
<aside class="notes">

</aside>
</section>
    </div>
  </div>

  <script src="https://unpkg.com/reveal.js@^4/dist/reveal.js"></script>

  <!-- reveal.js plugins -->
  <script src="https://unpkg.com/reveal.js@^4/plugin/notes/notes.js"></script>
  <script src="https://unpkg.com/reveal.js@^4/plugin/search/search.js"></script>
  <script src="https://unpkg.com/reveal.js@^4/plugin/zoom/zoom.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: true,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'bottom-right',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: true,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: false,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: true,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'default',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: true,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // reveal.js plugins
        plugins: [
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    </body>
</html>
